<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Asteroids</title>
    <style>
      body {
        margin: 0;
        background: #000;
        color: #fff;
        text-align: center;
        font-family: sans-serif;
      }

      canvas {
        display: block;
        margin: 10px auto;
        border: 1px solid #555;
        background: #020510;
      }
    </style>
  </head>
  <body>
    <h1>Asteroids</h1>
    <p>Arrows to rotate/thrust, Space to shoot.</p>
    <canvas id="gameCanvas" width="700" height="450"></canvas>

    <script>
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d');

      let ship = { x: 350, y: 225, angle: 0, vx: 0, vy: 0 };
      const keys = {};
      let shots = [];
      let asteroids = Array.from({ length: 6 }, createAsteroid);
      let score = 0;

      function createAsteroid() {
        return {
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          vx: (Math.random() - 0.5) * 2,
          vy: (Math.random() - 0.5) * 2,
          radius: 20 + Math.random() * 20,
        };
      }

      window.addEventListener('keydown', (event) => {
        keys[event.code] = true;
      });

      window.addEventListener('keyup', (event) => {
        keys[event.code] = false;
      });

      function update() {
        if (keys.ArrowLeft) ship.angle -= 0.08;
        if (keys.ArrowRight) ship.angle += 0.08;

        if (keys.ArrowUp) {
          ship.vx += Math.cos(ship.angle) * 0.1;
          ship.vy += Math.sin(ship.angle) * 0.1;
        }

        if (keys.Space && Math.random() < 0.25) {
          shots.push({
            x: ship.x,
            y: ship.y,
            vx: Math.cos(ship.angle) * 6,
            vy: Math.sin(ship.angle) * 6,
            life: 60,
          });
        }

        ship.x = (ship.x + ship.vx + canvas.width) % canvas.width;
        ship.y = (ship.y + ship.vy + canvas.height) % canvas.height;
        ship.vx *= 0.99;
        ship.vy *= 0.99;

        shots.forEach((shot) => {
          shot.x = (shot.x + shot.vx + canvas.width) % canvas.width;
          shot.y = (shot.y + shot.vy + canvas.height) % canvas.height;
          shot.life -= 1;
        });
        shots = shots.filter((shot) => shot.life > 0);

        asteroids.forEach((asteroid) => {
          asteroid.x = (asteroid.x + asteroid.vx + canvas.width) % canvas.width;
          asteroid.y = (asteroid.y + asteroid.vy + canvas.height) % canvas.height;
        });

        const asteroidCollisionIndexes = new Set();
        for (let i = 0; i < asteroids.length; i += 1) {
          for (let j = i + 1; j < asteroids.length; j += 1) {
            const a = asteroids[i];
            const b = asteroids[j];
            if (Math.hypot(a.x - b.x, a.y - b.y) < a.radius + b.radius) {
              asteroidCollisionIndexes.add(i);
              asteroidCollisionIndexes.add(j);
            }
          }
        }

        asteroids = asteroids.filter((asteroid, index) => {
          if (asteroidCollisionIndexes.has(index)) {
            return false;
          }

          for (const shot of shots) {
            if (Math.hypot(asteroid.x - shot.x, asteroid.y - shot.y) < asteroid.radius) {
              shot.life = 0;
              score += 10;
              return false;
            }
          }

          if (Math.hypot(asteroid.x - ship.x, asteroid.y - ship.y) < asteroid.radius + 10) {
            score = 0;
            ship = { x: 350, y: 225, angle: 0, vx: 0, vy: 0 };
          }

          return true;
        });

        while (asteroids.length < 6) {
          asteroids.push(createAsteroid());
        }
      }

      function draw() {
        ctx.fillStyle = '#020510';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Ship
        ctx.strokeStyle = '#fff';
        ctx.save();
        ctx.translate(ship.x, ship.y);
        ctx.rotate(ship.angle);
        ctx.beginPath();
        ctx.moveTo(12, 0);
        ctx.lineTo(-10, 8);
        ctx.lineTo(-6, 0);
        ctx.lineTo(-10, -8);
        ctx.closePath();
        ctx.stroke();
        ctx.restore();

        // Shots
        ctx.fillStyle = '#fff';
        shots.forEach((shot) => {
          ctx.fillRect(shot.x - 1, shot.y - 1, 3, 3);
        });

        // Asteroids
        asteroids.forEach((asteroid) => {
          ctx.fillStyle = '#7b4a1d';
          ctx.strokeStyle = '#a97a4f';
          ctx.beginPath();
          ctx.arc(asteroid.x, asteroid.y, asteroid.radius, 0, Math.PI * 2);
          ctx.fill();
          ctx.stroke();
        });

        ctx.fillStyle = '#fff';
        ctx.fillText(`Score: ${score}`, 10, 18);
      }

      function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
      }

      gameLoop();
    </script>
  </body>
</html>
